<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>IROA - Intelligent Resource Optimization Agent</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üß†</text></svg>">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    body { font-family: 'Inter', sans-serif; }
    .chart-container { position: relative; height: 300px; }
    .tab-content { min-height: 400px; }
    .vm-card { transition: all 0.2s ease-in-out; }
    .vm-card:hover { transform: translateY(-2px); }
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      min-width: 300px;
      padding: 16px;
      border-radius: 8px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      animation: slideIn 0.3s ease-out;
    }
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    .loading-spinner {
      border: 2px solid #f3f4f6;
      border-top: 2px solid #3b82f6;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- Notification System -->
    <div v-if="notification" :class="[
      'notification',
      notification.type === 'success' ? 'bg-green-100 border border-green-400 text-green-700' : 
      notification.type === 'error' ? 'bg-red-100 border border-red-400 text-red-700' :
      'bg-blue-100 border border-blue-400 text-blue-700'
    ]">
      <div class="flex items-center justify-between">
        <div class="flex items-center">
          <i :data-lucide="notification.type === 'success' ? 'check-circle' : notification.type === 'error' ? 'x-circle' : 'info'" class="w-5 h-5 mr-2"></i>
          <span>{{ notification.message }}</span>
        </div>
        <button @click="notification = null" class="ml-4 text-gray-400 hover:text-gray-600">
          <i data-lucide="x" class="w-4 h-4"></i>
        </button>
      </div>
    </div>

    <div class="min-h-screen bg-gray-50">
      <!-- Header -->
      <header class="bg-white shadow-sm border-b border-gray-200">
        <div class="container mx-auto px-6 py-4">
          <div class="flex items-center justify-between">
            <div class="flex items-center space-x-3">
              <div class="w-10 h-10 bg-gradient-to-br from-blue-600 to-purple-600 rounded-xl flex items-center justify-center">
                <span class="text-white font-bold text-lg">üß†</span>
              </div>
              <div>
                <h1 class="text-2xl font-bold text-gray-900">IROA</h1>
                <p class="text-sm text-gray-500">Intelligent Resource Optimization Agent</p>
              </div>
            </div>
            <div class="flex items-center space-x-4">
              <div class="flex items-center space-x-2 text-sm">
                <div :class="apiConnected ? 'bg-green-500' : 'bg-red-500'" class="w-2 h-2 rounded-full"></div>
                <span :class="apiConnected ? 'text-green-600' : 'text-red-600'">{{ apiConnected ? 'API Connected' : 'API Disconnected' }}</span>
              </div>
            </div>
          </div>
        </div>
      </header>

      <!-- Navigation Tabs -->
      <nav class="bg-white border-b border-gray-200">
        <div class="container mx-auto px-6">
          <div class="flex space-x-8">
            <button 
              v-for="tab in tabs" 
              :key="tab.id"
              @click="activeTab = tab.id"
              :class="[
                'py-4 px-2 border-b-2 font-medium text-sm transition-colors duration-200',
                activeTab === tab.id 
                  ? 'border-blue-500 text-blue-600' 
                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
              ]"
            >
              <i :data-lucide="tab.icon" class="w-4 h-4 inline-block mr-2"></i>
              {{ tab.name }}
            </button>
          </div>
        </div>
      </nav>

      <!-- Main Content -->
      <main class="container mx-auto px-6 py-8">
        <!-- Overview Tab -->
        <div v-if="activeTab === 'overview'" class="tab-content">
          <div class="mb-8">
            <h2 class="text-3xl font-bold text-gray-900 mb-2">Dashboard Overview</h2>
            <p class="text-gray-600">Monitor your virtualization infrastructure at a glance</p>
          </div>

          <!-- Stats Grid -->
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div v-for="stat in stats" :key="stat.title" class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm font-medium text-gray-600">{{ stat.title }}</p>
                  <p class="text-2xl font-bold text-gray-900 mt-1">{{ stat.value }}</p>
                </div>
                <div :class="[stat.bgColor, 'w-12 h-12 rounded-lg flex items-center justify-center']">
                  <i :data-lucide="stat.icon" class="w-6 h-6 text-white"></i>
                </div>
              </div>
              <div v-if="stat.change !== 0" class="mt-4 flex items-center">
                <i :data-lucide="stat.change > 0 ? 'trending-up' : 'trending-down'" 
                   :class="[stat.change > 0 ? 'text-green-500' : 'text-red-500', 'w-4 h-4 mr-1']"></i>
                <span :class="[stat.change > 0 ? 'text-green-600' : 'text-red-600', 'text-sm font-medium']">
                  {{ Math.abs(stat.change) }}%
                </span>
                <span class="text-gray-500 text-sm ml-1">vs last month</span>
              </div>
            </div>
          </div>

          <!-- Charts -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
              <h3 class="text-lg font-semibold text-gray-900 mb-4">Resource Usage</h3>
              <div class="chart-container">
                <canvas id="usageChart"></canvas>
              </div>
            </div>
            <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
              <h3 class="text-lg font-semibold text-gray-900 mb-4">VM Distribution</h3>
              <div class="chart-container">
                <canvas id="distributionChart"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- Administration Tab -->
        <div v-if="activeTab === 'admin'" class="tab-content">
          <div class="mb-8">
            <h2 class="text-3xl font-bold text-gray-900 mb-2">System Administration</h2>
            <p class="text-gray-600">Manage integrations and system monitoring</p>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Integration Selection -->
            <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
              <h3 class="text-lg font-semibold text-gray-900 mb-4">Available Integrations</h3>
              <div class="space-y-3">
                <div 
                  v-for="option in adminData.integrationOptions" 
                  :key="option.id"
                  @click="adminData.selectedIntegration = option.id"
                  :class="[
                    'p-4 rounded-lg border-2 cursor-pointer transition-all duration-200',
                    adminData.selectedIntegration === option.id 
                      ? 'border-blue-500 bg-blue-50' 
                      : 'border-gray-200 hover:border-gray-300'
                  ]"
                >
                  <div class="flex items-center space-x-3">
                    <span class="text-2xl">{{ option.icon }}</span>
                    <div>
                      <h4 class="font-medium text-gray-900">{{ option.name }}</h4>
                      <p class="text-sm text-gray-500">{{ option.description }}</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Mac System Integration -->
            <div v-if="adminData.selectedIntegration === 'mac'" class="lg:col-span-2 bg-white rounded-xl shadow-sm p-6 border border-gray-100">
              <h3 class="text-lg font-semibold text-gray-900 mb-4">üçé Mac System Monitoring</h3>
              
              <!-- Mac System Controls -->
              <div class="space-y-4">
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                  <div>
                    <h4 class="font-medium text-gray-900">System Monitoring</h4>
                    <p class="text-sm text-gray-500">
                      Status: {{ adminData.macMonitoring.isRunning ? 'Running' : 'Stopped' }}
                    </p>
                  </div>
                  <div class="flex space-x-2">
                    <button 
                      @click="startMacMonitoring"
                      :disabled="adminData.macMonitoring.isRunning"
                      class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                      Start
                    </button>
                    <button 
                      @click="stopMacMonitoring"
                      :disabled="!adminData.macMonitoring.isRunning"
                      class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                      Stop
                    </button>
                    <button 
                      @click="getMacStats"
                      class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"
                    >
                      Get Stats
                    </button>
                  </div>
                </div>

                <!-- System Info -->
                <div v-if="adminData.macMonitoring.systemInfo" class="p-4 bg-blue-50 rounded-lg">
                  <h4 class="font-medium text-gray-900 mb-2">System Information</h4>
                  <div class="grid grid-cols-2 gap-4 text-sm">
                    <div><strong>Model:</strong> {{ adminData.macMonitoring.systemInfo.model }}</div>
                    <div><strong>CPU:</strong> {{ adminData.macMonitoring.systemInfo.cpu }}</div>
                    <div><strong>Memory:</strong> {{ adminData.macMonitoring.systemInfo.memory }}</div>
                    <div><strong>Serial:</strong> {{ adminData.macMonitoring.systemInfo.serial }}</div>
                  </div>
                </div>

                <!-- Current Stats -->
                <div v-if="adminData.macMonitoring.currentStats" class="p-4 bg-green-50 rounded-lg">
                  <h4 class="font-medium text-gray-900 mb-2">Current Statistics</h4>
                  <div class="grid grid-cols-3 gap-4 text-sm">
                    <div class="text-center">
                      <div class="text-2xl font-bold text-blue-600">{{ adminData.macMonitoring.currentStats.cpu_usage }}%</div>
                      <div class="text-gray-600">CPU Usage</div>
                    </div>
                    <div class="text-center">
                      <div class="text-2xl font-bold text-green-600">{{ adminData.macMonitoring.currentStats.memory_usage }}%</div>
                      <div class="text-gray-600">Memory Usage</div>
                    </div>
                    <div class="text-center">
                      <div class="text-2xl font-bold text-purple-600">{{ adminData.macMonitoring.currentStats.disk_usage }}%</div>
                      <div class="text-gray-600">Disk Usage</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- VMware vCenter Integration -->
            <div v-if="adminData.selectedIntegration === 'vcenter'" class="lg:col-span-2 bg-white rounded-xl shadow-sm p-6 border border-gray-100">
              <h3 class="text-lg font-semibold text-gray-900 mb-4">üè¢ VMware vCenter Configuration</h3>
              <p class="text-gray-600 mb-6">Connect to your VMware vCenter Server for VM management and monitoring.</p>
              
              <div class="space-y-4">
                <div>
                  <label for="vcenter-host" class="block text-sm font-medium text-gray-700 mb-1">vCenter Host/IP</label>
                  <input id="vcenter-host" v-model="adminData.connectionForms.vcenter.host" type="text" 
                         placeholder="vcenter.company.com or 192.168.1.100"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                  <label for="vcenter-username" class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                  <input id="vcenter-username" v-model="adminData.connectionForms.vcenter.username" type="text" 
                         placeholder="administrator@vsphere.local"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                  <label for="vcenter-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                  <input id="vcenter-password" v-model="adminData.connectionForms.vcenter.password" type="password" 
                         placeholder="Enter vCenter password"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div class="flex space-x-2">
                  <button @click="testConnection('vcenter')" :disabled="loading.connectionTest"
                          class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 flex items-center">
                    <div v-if="loading.connectionTest" class="loading-spinner mr-2"></div>
                    <i v-else data-lucide="wifi" class="w-4 h-4 mr-2"></i>
                    {{ loading.connectionTest ? 'Testing...' : 'Test Connection' }}
                  </button>
                  <button @click="saveIntegration('vcenter')" :disabled="!isFormValid('vcenter')"
                          class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 flex items-center">
                    <i data-lucide="save" class="w-4 h-4 mr-2"></i>
                    Save Configuration
                  </button>
                </div>
              </div>
            </div>

            <!-- Zabbix Integration -->
            <div v-if="adminData.selectedIntegration === 'zabbix'" class="lg:col-span-2 bg-white rounded-xl shadow-sm p-6 border border-gray-100">
              <h3 class="text-lg font-semibold text-gray-900 mb-4">üìä Zabbix Configuration</h3>
              <p class="text-gray-600 mb-6">Connect to your Zabbix monitoring system for comprehensive infrastructure monitoring.</p>
              
              <div class="space-y-4">
                <div>
                  <label for="zabbix-url" class="block text-sm font-medium text-gray-700 mb-1">Zabbix API URL</label>
                  <input id="zabbix-url" v-model="adminData.connectionForms.zabbix.url" type="url" 
                         placeholder="http://zabbix.company.com/api_jsonrpc.php"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                  <label for="zabbix-username" class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                  <input id="zabbix-username" v-model="adminData.connectionForms.zabbix.username" type="text" 
                         placeholder="Admin"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                  <label for="zabbix-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                  <input id="zabbix-password" v-model="adminData.connectionForms.zabbix.password" type="password" 
                         placeholder="Enter Zabbix password"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div class="flex space-x-2">
                  <button @click="testConnection('zabbix')" :disabled="loading.connectionTest"
                          class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 flex items-center">
                    <div v-if="loading.connectionTest" class="loading-spinner mr-2"></div>
                    <i v-else data-lucide="wifi" class="w-4 h-4 mr-2"></i>
                    {{ loading.connectionTest ? 'Testing...' : 'Test Connection' }}
                  </button>
                  <button @click="saveIntegration('zabbix')" :disabled="!isFormValid('zabbix')"
                          class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 flex items-center">
                    <i data-lucide="save" class="w-4 h-4 mr-2"></i>
                    Save Configuration
                  </button>
                </div>
              </div>
            </div>

            <!-- Prometheus Integration -->
            <div v-if="adminData.selectedIntegration === 'prometheus'" class="lg:col-span-2 bg-white rounded-xl shadow-sm p-6 border border-gray-100">
              <h3 class="text-lg font-semibold text-gray-900 mb-4">üî• Prometheus Configuration</h3>
              <p class="text-gray-600 mb-6">Connect to your Prometheus server for metrics collection and monitoring.</p>
              
              <div class="space-y-4">
                <div>
                  <label for="prometheus-url" class="block text-sm font-medium text-gray-700 mb-1">Prometheus Server URL</label>
                  <input id="prometheus-url" v-model="adminData.connectionForms.prometheus.url" type="url" 
                         placeholder="http://prometheus.company.com:9090"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                  <label for="prometheus-username" class="block text-sm font-medium text-gray-700 mb-1">Username (Optional)</label>
                  <input id="prometheus-username" v-model="adminData.connectionForms.prometheus.username" type="text" 
                         placeholder="Leave empty if no authentication"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                  <label for="prometheus-password" class="block text-sm font-medium text-gray-700 mb-1">Password (Optional)</label>
                  <input id="prometheus-password" v-model="adminData.connectionForms.prometheus.password" type="password" 
                         placeholder="Leave empty if no authentication"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div class="flex space-x-2">
                  <button @click="testConnection('prometheus')" :disabled="loading.connectionTest"
                          class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 flex items-center">
                    <div v-if="loading.connectionTest" class="loading-spinner mr-2"></div>
                    <i v-else data-lucide="wifi" class="w-4 h-4 mr-2"></i>
                    {{ loading.connectionTest ? 'Testing...' : 'Test Connection' }}
                  </button>
                  <button @click="saveIntegration('prometheus')" :disabled="!isFormValid('prometheus')"
                          class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 flex items-center">
                    <i data-lucide="save" class="w-4 h-4 mr-2"></i>
                    Save Configuration
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Recommendations Tab -->
        <div v-if="activeTab === 'recommendations'" class="tab-content">
          <div class="mb-8">
            <h2 class="text-3xl font-bold text-gray-900 mb-2">AI Recommendations</h2>
            <p class="text-gray-600">Optimize your infrastructure with AI-powered insights</p>
          </div>

          <div class="mb-6">
            <button @click="loadRecommendations" :disabled="loading.recommendations" 
                    class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 flex items-center">
              <div v-if="loading.recommendations" class="loading-spinner mr-2"></div>
              <i v-else data-lucide="refresh-cw" class="w-4 h-4 mr-2"></i>
              {{ loading.recommendations ? 'Loading...' : 'Refresh Recommendations' }}
            </button>
          </div>

          <div v-if="recommendations.length === 0 && !loading.recommendations" class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
            <div class="flex items-center">
              <i data-lucide="info" class="w-5 h-5 text-yellow-600 mr-2"></i>
              <p class="text-yellow-800">No recommendations available. Click "Refresh Recommendations" to load data.</p>
            </div>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div v-for="rec in recommendations" :key="rec.vm" class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
              <div class="flex items-start justify-between mb-4">
                <div>
                  <h3 class="text-lg font-semibold text-gray-900">{{ rec.vm }}</h3>
                  <p class="text-sm text-gray-500">{{ rec.reason }}</p>
                </div>
                <div class="px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm font-medium">
                  Optimization
                </div>
              </div>
              <p class="text-gray-700 mb-4">{{ rec.suggestion }}</p>
              <div v-if="rec.details" class="bg-gray-50 rounded-lg p-3">
                <div class="grid grid-cols-2 gap-2 text-sm">
                  <div><strong>Avg CPU:</strong> {{ rec.details.avg_cpu }}%</div>
                  <div><strong>Avg Memory:</strong> {{ rec.details.avg_mem }}%</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Virtual Machines Tab -->
        <div v-if="activeTab === 'vms'" class="tab-content">
          <div class="mb-8">
            <h2 class="text-3xl font-bold text-gray-900 mb-2">Virtual Machines</h2>
            <p class="text-gray-600">Monitor and manage your virtual infrastructure</p>
          </div>

          <div class="mb-6 flex items-center justify-between">
            <button @click="loadUnderutilizedVMs" :disabled="loading.vms" 
                    class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 flex items-center">
              <div v-if="loading.vms" class="loading-spinner mr-2"></div>
              <i v-else data-lucide="server" class="w-4 h-4 mr-2"></i>
              {{ loading.vms ? 'Loading...' : 'Load Underutilized VMs' }}
            </button>
            <div class="flex items-center space-x-4">
              <input v-model="vmSearchTerm" type="text" placeholder="Search VMs..." 
                     class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
          </div>

          <div v-if="filteredVMs.length === 0 && !loading.vms" class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
            <div class="flex items-center">
              <i data-lucide="info" class="w-5 h-5 text-blue-600 mr-2"></i>
              <p class="text-blue-800">No VMs found. Click "Load Underutilized VMs" to fetch data from the API.</p>
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div v-for="vm in filteredVMs" :key="vm.vm" class="vm-card bg-white rounded-xl shadow-sm p-6 border border-gray-100">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-900">{{ vm.vm }}</h3>
                <div class="px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs font-medium">
                  Underutilized
                </div>
              </div>
              <div class="space-y-3">
                <div class="flex justify-between items-center">
                  <span class="text-sm text-gray-600">CPU Usage</span>
                  <div class="flex items-center">
                    <div class="w-20 bg-gray-200 rounded-full h-2 mr-2">
                      <div class="bg-blue-500 h-2 rounded-full" :style="{width: vm.details?.avg_cpu + '%'}"></div>
                    </div>
                    <span class="text-sm font-medium">{{ vm.details?.avg_cpu }}%</span>
                  </div>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-sm text-gray-600">Memory Usage</span>
                  <div class="flex items-center">
                    <div class="w-20 bg-gray-200 rounded-full h-2 mr-2">
                      <div class="bg-green-500 h-2 rounded-full" :style="{width: vm.details?.avg_mem + '%'}"></div>
                    </div>
                    <span class="text-sm font-medium">{{ vm.details?.avg_mem }}%</span>
                  </div>
                </div>
              </div>
              <div class="mt-4 pt-4 border-t border-gray-100">
                <p class="text-sm text-gray-600">{{ vm.suggestion }}</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Analytics Tab -->
        <div v-if="activeTab === 'analytics'" class="tab-content">
          <div class="mb-8">
            <h2 class="text-3xl font-bold text-gray-900 mb-2">Analytics</h2>
            <p class="text-gray-600">Deep insights into your infrastructure performance</p>
          </div>

          <div class="mb-6">
            <div class="flex items-center space-x-4 flex-wrap gap-2">
              <button @click="loadForecast(1)" :disabled="loading.analytics" 
                      class="px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:opacity-50 flex items-center">
                <div v-if="loading.analytics" class="loading-spinner mr-2"></div>
                <i v-else data-lucide="trending-up" class="w-4 h-4 mr-2"></i>
                {{ loading.analytics ? 'Loading...' : 'Load Forecast (VM 1)' }}
              </button>
              <button @click="loadAnomalies(1)" :disabled="loading.anomalies" 
                      class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50 flex items-center">
                <div v-if="loading.anomalies" class="loading-spinner mr-2"></div>
                <i v-else data-lucide="alert-triangle" class="w-4 h-4 mr-2"></i>
                {{ loading.anomalies ? 'Loading...' : 'Detect Anomalies (VM 1)' }}
              </button>
              <button @click="loadPrometheusAnalytics()" :disabled="loading.analytics" 
                      class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 flex items-center">
                <div v-if="loading.analytics" class="loading-spinner mr-2"></div>
                <i v-else data-lucide="monitor" class="w-4 h-4 mr-2"></i>
                {{ loading.analytics ? 'Loading...' : 'Load Mac Analytics (Prometheus)' }}
              </button>
            </div>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Forecast Results -->
            <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
              <h3 class="text-lg font-semibold text-gray-900 mb-4">CPU Forecast</h3>
              <div v-if="forecast.length === 0" class="text-gray-500 text-center py-8">
                <i data-lucide="bar-chart-3" class="w-12 h-12 mx-auto mb-2 text-gray-300"></i>
                <p>No forecast data available. Click "Load Forecast" to generate predictions.</p>
              </div>
              <div v-else>
                <div class="space-y-2">
                  <div v-for="(point, index) in forecast.slice(0, 5)" :key="index" class="flex justify-between items-center py-2 border-b border-gray-100">
                    <span class="text-sm text-gray-600">Hour {{ index + 1 }}</span>
                    <span class="font-medium">{{ point.toFixed(1) }}% CPU</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Anomaly Results -->
            <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
              <h3 class="text-lg font-semibold text-gray-900 mb-4">Anomaly Detection</h3>
              <div v-if="anomalies.length === 0" class="text-gray-500 text-center py-8">
                <i data-lucide="shield-check" class="w-12 h-12 mx-auto mb-2 text-gray-300"></i>
                <p>No anomaly data available. Click "Detect Anomalies" to analyze patterns.</p>
              </div>
              <div v-else class="space-y-3">
                <div v-for="(anomaly, index) in anomalies" :key="index" 
                     class="p-3 bg-red-50 border border-red-200 rounded-lg">
                  <div class="flex items-center">
                    <i data-lucide="alert-triangle" class="w-4 h-4 text-red-600 mr-2"></i>
                    <span class="text-sm font-medium text-red-800">Anomaly Detected</span>
                  </div>
                  <p class="text-sm text-red-700 mt-1">{{ anomaly.description || 'Unusual pattern detected in system metrics' }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <script>
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          activeTab: 'overview',
          apiConnected: false,
          notification: null,
          vmSearchTerm: '',
          recommendations: [],
          underutilizedVMs: [],
          forecast: [],
          anomalies: [],
          loading: {
            recommendations: false,
            vms: false,
            analytics: false,
            anomalies: false,
            connectionTest: false
          },
          tabs: [
            { id: 'overview', name: 'Overview', icon: 'layout-dashboard' },
            { id: 'recommendations', name: 'Recommendations', icon: 'lightbulb' },
            { id: 'vms', name: 'Virtual Machines', icon: 'server' },
            { id: 'analytics', name: 'Analytics', icon: 'bar-chart-3' },
            { id: 'admin', name: 'Administration', icon: 'settings' }
          ],
          stats: [
            { title: 'Total VMs', value: '5', change: 0, icon: 'server', bgColor: 'bg-blue-500' },
            { title: 'Underutilized', value: '2', change: -20, icon: 'trending-down', bgColor: 'bg-yellow-500' },
            { title: 'Cost Savings', value: '$1,240', change: 15, icon: 'dollar-sign', bgColor: 'bg-green-500' },
            { title: 'Efficiency', value: '87%', change: 5, icon: 'zap', bgColor: 'bg-purple-500' }
          ],
          adminData: {
            selectedIntegration: 'mac',
            macMonitoring: {
              isRunning: false,
              interval: 30,
              lastUpdate: null,
              systemInfo: null,
              currentStats: null
            },
            integrationOptions: [
              { id: 'mac', name: 'Mac System', icon: 'üçé', description: 'Monitor your Mac system resources' },
              { id: 'vcenter', name: 'VMware vCenter', icon: 'üè¢', description: 'Connect to VMware vCenter Server' },
              { id: 'zabbix', name: 'Zabbix', icon: 'üìä', description: 'Integrate with Zabbix monitoring' },
              { id: 'prometheus', name: 'Prometheus', icon: 'üî•', description: 'Connect to Prometheus metrics' }
            ],
            connectionForms: {
              vcenter: { host: 'vcenter.local', username: 'administrator@vsphere.local', password: '' },
              zabbix: { url: 'http://zabbix.local/api_jsonrpc.php', username: 'Admin', password: '' },
              prometheus: { url: 'http://localhost:9090', username: '', password: '' }
            }
          }
        };
      },
      computed: {
        filteredVMs() {
          if (!this.vmSearchTerm) return this.underutilizedVMs;
          return this.underutilizedVMs.filter(vm => 
            vm.vm.toLowerCase().includes(this.vmSearchTerm.toLowerCase())
          );
        }
      },
      methods: {
        // Notification system
        showNotification(message, type = 'info') {
          this.notification = { message, type };
          setTimeout(() => {
            this.notification = null;
          }, 5000);
        },

        // API connectivity check
        async checkAPIConnection() {
          try {
            const response = await fetch('http://localhost:8001/health');
            const data = await response.json();
            this.apiConnected = data.status === 'ok';
          } catch (error) {
            this.apiConnected = false;
          }
        },

        // Recommendations methods
        async loadRecommendations() {
          this.loading.recommendations = true;
          try {
            const response = await fetch('http://localhost:8001/recommendations');
            const data = await response.json();
            this.recommendations = data;
            this.showNotification(`Loaded ${data.length} recommendations`, 'success');
          } catch (error) {
            this.showNotification('Failed to load recommendations: ' + error.message, 'error');
          } finally {
            this.loading.recommendations = false;
          }
        },

        // VM methods
        async loadUnderutilizedVMs() {
          this.loading.vms = true;
          try {
            const response = await fetch('http://localhost:8001/vms');
            const data = await response.json();
            this.underutilizedVMs = data;
            const macVM = data.find(vm => vm.source === 'prometheus');
            const message = macVM ? 
              `Found ${data.length} VMs (including Mac system from Prometheus)` : 
              `Found ${data.length} VMs`;
            this.showNotification(message, 'success');
          } catch (error) {
            this.showNotification('Failed to load VMs: ' + error.message, 'error');
          } finally {
            this.loading.vms = false;
          }
        },

        // Analytics methods
        async loadForecast(vmId) {
          this.loading.analytics = true;
          try {
            const response = await fetch(`http://localhost:8001/forecast/${vmId}?hours=24`);
            const data = await response.json();
            this.forecast = data.cpu_forecast || [];
            this.showNotification('CPU forecast loaded successfully', 'success');
          } catch (error) {
            this.showNotification('Failed to load forecast: ' + error.message, 'error');
          } finally {
            this.loading.analytics = false;
          }
        },

        async loadAnomalies(vmId) {
          this.loading.anomalies = true;
          try {
            const response = await fetch(`http://localhost:8001/anomalies/${vmId}`);
            const data = await response.json();
            this.anomalies = data.anomalies || [];
            this.showNotification(`Found ${this.anomalies.length} anomalies`, 'success');
          } catch (error) {
            this.showNotification('Failed to load anomalies: ' + error.message, 'error');
          } finally {
            this.loading.anomalies = false;
          }
        },

        async loadPrometheusAnalytics() {
          this.loading.analytics = true;
          try {
            const response = await fetch('http://localhost:8001/analytics/prometheus');
            const data = await response.json();
            
            // Update forecast with Prometheus CPU data
            this.forecast = data.cpu_history || [];
            
            // Create anomalies from memory spikes (>80% usage)
            this.anomalies = [];
            if (data.memory_history) {
              data.memory_history.forEach((memUsage, index) => {
                if (memUsage > 80) {
                  this.anomalies.push({
                    timestamp: new Date(Date.now() - (data.memory_history.length - index) * 300000).toISOString(),
                    metric: 'memory_usage',
                    value: memUsage,
                    severity: 'high',
                    description: `High memory usage: ${memUsage.toFixed(1)}%`
                  });
                }
              });
            }
            
            this.showNotification(`Loaded Mac analytics from Prometheus (${data.timeframe})`, 'success');
          } catch (error) {
            this.showNotification('Failed to load Prometheus analytics: ' + error.message, 'error');
          } finally {
            this.loading.analytics = false;
          }
        },

        // Mac monitoring methods
        async startMacMonitoring() {
          try {
            const response = await fetch('http://localhost:8001/admin/mac/start', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ interval: this.adminData.macMonitoring.interval })
            });
            const data = await response.json();
            if (data.status === 'started') {
              this.adminData.macMonitoring.isRunning = true;
              this.showNotification('Mac monitoring started successfully!', 'success');
            }
          } catch (error) {
            this.showNotification('Failed to start Mac monitoring: ' + error.message, 'error');
          }
        },

        async stopMacMonitoring() {
          try {
            const response = await fetch('http://localhost:8001/admin/mac/stop', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' }
            });
            const data = await response.json();
            if (data.status === 'stopped') {
              this.adminData.macMonitoring.isRunning = false;
              this.showNotification('Mac monitoring stopped successfully!', 'success');
            }
          } catch (error) {
            this.showNotification('Failed to stop Mac monitoring: ' + error.message, 'error');
          }
        },

        async getMacStats() {
          try {
            const response = await fetch('http://localhost:8001/admin/mac/stats');
            const data = await response.json();
            this.adminData.macMonitoring.systemInfo = data.system_info;
            this.adminData.macMonitoring.currentStats = {
              cpu_usage: Math.round(data.cpu_usage * 10) / 10,
              memory_usage: Math.round(data.memory_usage * 10) / 10,
              disk_usage: Math.round(data.disk_usage * 10) / 10
            };
            this.adminData.macMonitoring.isRunning = data.monitoring_active;
            this.showNotification('Mac stats updated successfully', 'success');
          } catch (error) {
            this.showNotification('Failed to get Mac stats: ' + error.message, 'error');
          }
        },

        // Integration methods
        async testConnection(integrationType) {
          this.loading.connectionTest = true;
          try {
            const form = this.adminData.connectionForms[integrationType];
            const endpoint = `http://localhost:8001/admin/${integrationType}/test`;
            
            const response = await fetch(endpoint, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(form)
            });
            
            const data = await response.json();
            
            if (response.ok && data.status === 'success') {
              this.showNotification(data.message, 'success');
            } else {
              this.showNotification(data.detail || 'Connection test failed', 'error');
            }
          } catch (error) {
            this.showNotification('Connection test failed: ' + error.message, 'error');
          } finally {
            this.loading.connectionTest = false;
          }
        },

        saveIntegration(integrationType) {
          // For now, just show a success message
          this.showNotification(`${integrationType} configuration saved successfully`, 'success');
        },

        isFormValid(integrationType) {
          const form = this.adminData.connectionForms[integrationType];
          switch (integrationType) {
            case 'vcenter':
              return form.host && form.username && form.password;
            case 'zabbix':
              return form.url && form.username && form.password;
            case 'prometheus':
              return form.url; // Username/password optional for Prometheus
            default:
              return false;
          }
        },
        initializeCharts() {
          // Usage Chart
          const usageCtx = document.getElementById('usageChart');
          if (usageCtx) {
            new Chart(usageCtx, {
              type: 'line',
              data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                datasets: [{
                  label: 'CPU Usage',
                  data: [65, 59, 80, 81, 56, 55],
                  borderColor: 'rgb(59, 130, 246)',
                  backgroundColor: 'rgba(59, 130, 246, 0.1)',
                  tension: 0.4
                }]
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                  legend: {
                    display: false
                  }
                }
              }
            });
          }

          // Distribution Chart
          const distCtx = document.getElementById('distributionChart');
          if (distCtx) {
            new Chart(distCtx, {
              type: 'doughnut',
              data: {
                labels: ['Production', 'Development', 'Testing'],
                datasets: [{
                  data: [60, 25, 15],
                  backgroundColor: [
                    'rgb(59, 130, 246)',
                    'rgb(16, 185, 129)',
                    'rgb(245, 158, 11)'
                  ]
                }]
              },
              options: {
                responsive: true,
                maintainAspectRatio: false
              }
            });
          }
        }
      },
      mounted() {
        // Initialize Lucide icons
        if (typeof lucide !== 'undefined') {
          lucide.createIcons();
        }
        
        // Check API connection
        this.checkAPIConnection();
        
        // Initialize charts after a short delay
        this.$nextTick(() => {
          setTimeout(() => {
            this.initializeCharts();
            // Re-initialize icons after DOM updates
            if (typeof lucide !== 'undefined') {
              lucide.createIcons();
            }
          }, 100);
        });

        // Get initial Mac stats
        this.getMacStats();
        
        // Set up periodic API health check
        setInterval(() => {
          this.checkAPIConnection();
        }, 30000); // Check every 30 seconds
      },
      
      watch: {
        // Re-initialize icons when active tab changes
        activeTab() {
          this.$nextTick(() => {
            if (typeof lucide !== 'undefined') {
              lucide.createIcons();
            }
          });
        }
      }
    }).mount('#app');
  </script>
</body>
</html>
